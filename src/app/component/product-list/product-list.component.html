<div *ngIf="loading" style="margin: 30vh 50vw" class="spinner-container">
  <mat-spinner></mat-spinner>
  <div class="spinner-message">Loading, please wait...</div>
</div>
<div *ngIf="!loading" class="main-container" style="padding-bottom: 100px;">
  <div class="sidebar">
    <div class="subCategory">
      <h2>{{ categoryTitle }}</h2>
      <ul>
        <li *ngFor="let subCategory of subCategories">
          <i class="fa-solid fa-angle-left"></i>
          <a class="sub-links" routerLinkActive="active_link"
            [routerLink]="['/categories', categoryTitle, subCategory.name]">{{ subCategory.name | capitalize }}</a>
        </li>
      </ul>
    </div>

    <div *ngIf="subCategoryName" class="filters">
      <div class="availability">
        <h3 style="margin: 5px 0;">Availability</h3>
        <label><input type="checkbox" [(ngModel)]="filters.inStock"> In Stock (26)</label>
        <label><input type="checkbox" [(ngModel)]="filters.notAvailable"> Not Available (3)</label>
      </div>
      <div class="price-range">
        <h3 style="margin: 0; margin-top: 10px;">Price</h3>
        <app-custom-range-slider [min]="0" [max]="25000" [step]="10" [(minValue)]="filters.minPrice"
          [(maxValue)]="filters.maxPrice" (minValueChange)="onPriceRangeChange()"
          (maxValueChange)="onPriceRangeChange()">
        </app-custom-range-slider>
        <p>Range: ${{ filters.minPrice }} - ${{ filters.maxPrice }}</p>
      </div>
      <div class="color-filter">
        <h3 style="margin: 0 5px;">Color</h3>
        <div class="color-options">
          <label *ngFor="let color of colorOptions" class="color-swatch">
            <input type="checkbox" [checked]="filters.colors.includes(color)" (change)="onColorChange(color, $event)">
            <div class="color-indicator" [style.background]="color"></div>
          </label>
        </div>
      </div>
      <div class="size-filter">
        <h3 style="margin: 5px 0 5px;">Size</h3>
        <label><input type="checkbox" [checked]="filters.sizes.includes('small')" (change)="onSizeChange('small', $event)"> Small</label>
        <label><input type="checkbox" [checked]="filters.sizes.includes('medium')" (change)="onSizeChange('medium', $event)"> Medium</label>
      </div>
    </div>

  </div>

  <div style="height: 600px; width: 100%;" class="content-wrapper">
    <div *ngIf="categoryTitle && !subCategoryName" class="title-wrapper"
      [ngStyle]="{'background-image': subCategoryName ? 'url(' + currentSubCategoryImage + ')' : 'url(' + currentCategoryImage + ')'}">
    </div>
    <div *ngIf="subCategoryName" class="sort-options">
      <app-sort-options [currentSortOption]="currentSortOption" (change)="onSortChange($event)"></app-sort-options>
    </div>
    <main class="product-list" [ngStyle]="{'padding-bottom': subCategoryName ? '100px' : '0px'}">
      <app-product-card *ngFor="let product of products" [product]="product"></app-product-card>
    </main>
    <!-- Pagination Component -->
    <app-pagination *ngIf="subCategoryName" [currentPage]="currentPage" [totalPages]="totalPages"
      (pageChange)="onPageChange($event)">
    </app-pagination>

    <div *ngIf="categoryTitle && !subCategoryName" class="shop-by-category">
      <h2 style="margin-left: 8.5vw; margin-top: 20px;">Shop by category</h2>
      <div class="slider-container" style="width: 83vw;">
        <button class="nav-button left" (click)="scrollLeft(slider)">&#10094;</button>
        <div style="background-color: rgb(225, 230, 229); padding: 10px; margin: 5px;" class="slider-wrapper" #slider>
          <div style="margin: 5px;" class="slider">
            <div style="width: 306px; height: 230px;" class="category-item" *ngFor="let subCategory of subCategories">
              <img (click)="redirectToSubCategory(categoryTitle, subCategory.name)"
                style="width: 100%; height: 200px; cursor: pointer" [src]="subCategory.img" [alt]="subCategory.name">
              <a (click)="redirectToSubCategory(categoryTitle, subCategory.name)">{{ subCategory.name }}</a>
            </div>
          </div>
        </div>
        <button class="nav-button right" (click)="scrollRight(slider)">&#10095;</button>
      </div>
    </div>
  </div>
</div>